"use strict";(function(n){n.post=function(n,t,i){var r={"async":!0,crossDomain:!0,url:"",method:"POST",headers:{"Content-Type":"application/json","cache-control":"no-cache"},processData:!1,data:""};r.data=t;r.url=n;r.beforeSend=function(){};$.post(r).done(i).fail(function(){})}})(window,jQuery);var ovr={d:{},on:function(){ovr.d.rw=[];$("#btnsovr").click(ovr.new);$("#txshemp").keyup(ovr.empsearch).blur(function(){window.setTimeout(function(){$("#txshemp").val("").parent().find(".search-pn").remove()},500)});post("/ovr/getlist",null,function(n){typeof n=="string"&&($("#ovrlist").html(n),$("#bckit_tab_ovr").bcKitTab())});post("/ovr/category/get",null,function(n){var t=$("#ovrcat");$.each(n.data,function(n,i){$("<option/>").attr("value","").html("Select").appendTo(t);var r=$("<optgroup/>").attr("label",i.header);r.appendTo(t);$.each(i.values,function(n,t){$("<option/>").attr("value",n).html(t).appendTo(r)})});$(t).select2()});$("#btnovr").click(function(){ui_mpanel.show("bckit-modal-new","New Ovr",{})});$("#filetrigger").click(function(){$("#ifile").click()});$("#ifile").change(function(){var n;$("#fileList").html("");var u=$(this)[0],i=u.files,f=new FormData,t=0,r=$("<ul/>");for(n=0;n!=i.length;n++)t+=i[n].size,$(r).append($("<li/>").html(i[n].name));if(t=t/1024,t>5120){alert("File size is exceeded");return}$("#fileList").append(r)});$("textarea.form-control").trumbowyg({btns:[["strong","em","del"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["fullscreen"]]})},"new":function(){var n={},t=!1;if($("#ovrn").find(".form-control").each(function(){$(this).data("req")=="1"&&($(this).val()===""?($(this).addClass("form-control-req"),t=!0):$(this).removeClass("form-control-req"));var i=$(this).attr("id"),r=$(this).val();n[i]=r}),t){alert("Please fill the required details");return}if(ovr.d.rw.length==0){alert("Please add a wintess");return}n.description=$("#description").trumbowyg("html");post("/ovr/request/save",JSON.stringify({Details:n,Witness:ovr.d.rw}),function(n){if(n.status){var t=n.data;ovr.uploadFile("ifile",n.tKey,function(){alert("success")});$("#ovrn").find(".form-control").val("");ui_mpanel.hide();Swal.fire({title:"OVR Request",text:"OVR Request has been created",icon:"success"});window.setTimeout(function(){location.reload()},3e3)}else Swal.fire({title:"Error",text:n.message,icon:"error"})})},empsearch:function(){var n=$(this).val();n.length<3||($(this).parent().find(".search-pn").remove(),post("/ovr/emp/search",JSON.stringify({text:n}),function(n){if(n.status){if(n.data==null)return;var r=n.data.rows,u=$("#txshemp").parent(),t=$("<div/>"),i=$("<ul/>");i.appendTo(t);t.addClass("search-pn").appendTo(u);$(r).each(function(n,t){let r="<label>"+t[2]+" ("+t[1]+")<\/label>";r+="<label>"+t[5]+", "+t[4]+"<\/label>";$("<li/>").html(r).appendTo(i).click(function(){let n=t[0],r=t[2];var i=$("<label/>").addClass("itemsel").html("x | "+r);ovr.d.rw.push(n);$("#dvsremp").append(i),function(n,t){$(i).click(function(){const i=t.indexOf(n);i>-1&&t.splice(i,1);$(this).remove()})}(n,ovr.d.rw)})})}else alert(n.message)}))},wcupdate:function(){post("/ovr/action/witnesscomnt",JSON.stringify({comment:$("#tawc").val(),ovrid:$("#_ovr").val()}),function(n){n.status?(alert("Saved"),location.reload()):alert(n.message)})},acrequ:function(){var n={},t;n.ovrid=$("#_ovr").val();n.auth=ovr.d.rw[0];n.comnt=$("#tanetactn").val();t=$("#rctionsel").val();post("/ovr/actionr/request",JSON.stringify({Details:n,Witness:t}),function(n){n.status?(alert("Saved"),location.reload()):alert(n.message)})},acreqact:function(n){var t,i;confirm("Are you sure want to update ?.")&&(t={},t.id=$("#_ovr").val(),t.type=n,n=="T"?(t.value=n=="T",$("#selicdtype").val()):(i=$("#ovrcat").val(),t.value=i.join()),post("/ovr/actionp/updtc",JSON.stringify(t),function(n){n.status?(alert("Saved"),location.reload()):alert(n.message)}))},actreqcomnt:function(){if(confirm("Are you sure want to update ?.")){var n={};n.id=$("#selactrtype").val();n.type=$("#selactrtype :selected").text();n.ovrid=$("#_ovr").val();n.comment=$("#talactrtype").val();post("/ovr/actionr/comnt",JSON.stringify(n),function(n){n.status?(ovr.uploadFile("ifile",n.tKey,function(){alert("File uploaded")}),location.reload()):alert(n.message)})}},uploadFile:function(n,t,i){var e=document.getElementById(n),r;if(e.files.length!=0){var f=e.files,o=new FormData,u=0;for(r=0;r!=f.length;r++)u+=f[r].size,o.append("files",f[r]);if(u=u/1024,u>5120){alert("File size is exceeded");return}$.ajax({url:"/ovr/savfiles",data:o,processData:!1,contentType:!1,type:"POST",headers:{Authorization:t},success:function(){i()}})}}};$(document).ready(function(){ovr.on()});